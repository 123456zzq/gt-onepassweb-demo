"v1.0.4 Geetest Inc.";!function(a,b){"use strict";"object"==typeof exports&&"object"==typeof module?module.exports=b(a):"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.GOP=b(a):a.GOP=b(a)}("undefined"!=typeof window?window:this,function(window,noGlobal){function PureEvent(){this.a={}}function extend(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];a[c]=d}}function Error(){}function Onepass(a){this.gtapi_domain="onepass.geetest.com",this.protocol=location.protocol+"//",extend(this,a),this.phone=0,this.process_id="",this.w=new PureEvent}function GOP(a){var b=this;b.D=uid(),b.F=!0,data.u(b.D,new Onepass(a))}window=window||this;var _Promise=function(a){function b(){var a=this;a.g=a.h=null}function c(a){var e=this;if(e.m=e.PENDING,e.n=new b,e.o=new b,d(a))try{a(function(a){e.l(a)},function(a){e.j(a)})}catch(f){c.k(f)}}var d=function(a){return"function"==typeof a},e=function(a){return"object"==typeof a&&null!==a},f=function(a){a()};b.prototype={enqueue:function(a){var b=this,c={ele:a,next:null};null===b.g?b.g=this.h=c:(b.h.next=c,b.h=b.h.next)},dequeue:function(){var a=this;if(null===a.g)throw new Error("queue is empty");var b=a.g.ele;return a.g=a.g.next,b},isEmpty:function(){return null===this.g},clear:function(){var a=this;a.g=a.i=null},each:function(a){var b=this;b.isEmpty()||(a(b.dequeue()),b.each(a))}};var g=function(a,b){if(a===b)a.j(new TypeError);else if(b instanceof c)b.then(function(b){g(a,b)},function(b){a.j(b)});else if(d(b)||e(b)){var f;try{f=b.then}catch(i){return c.k(i),void a.j(i)}var h=!1;if(d(f))try{f.call(b,function(b){h||(h=!0,g(a,b))},function(b){h||(h=!0,a.j(b))})}catch(i){if(h)return;h=!0,a.j(i)}else a.l(b)}else a.l(b)},h=!1;return c.debug=function(){h=!0},c.k=function(a){h&&"undefined"!=typeof console&&console.error(a)},c.prototype={PENDING:0,RESOLVED:1,REJECTED:-1,l:function(a){var b=this;b.m===b.PENDING&&(b.m=b.RESOLVED,b.p=a,b.q())},j:function(a){var b=this;b.m===b.PENDING&&(b.m=b.REJECTED,b.r=a,b.q())},q:function(){var a,b,c=this,d=c.m;d===c.RESOLVED?(a=c.n,c.o.clear(),b=c.p):d===c.REJECTED&&(a=c.o,c.n.clear(),b=c.r),a.each(function(a){f(function(){a(d,b)})})},s:function(a,b,e){var h=this;f(function(){if(d(b)){var f;try{f=b(e)}catch(i){return c.k(i),void h.j(i)}g(h,f)}else a===h.RESOLVED?h.l(e):a===h.REJECTED&&h.j(e)})},then:function(a,b){var d=this,e=new c;return d.n.enqueue(function(b,c){e.s(b,a,c)}),d.o.enqueue(function(a,c){e.s(a,b,c)}),d.m===d.RESOLVED?d.q():d.m===d.REJECTED&&d.q(),e}},c.all=function(a){return new c(function(b,d){function e(a,c,e){h||(null!==a&&(h=!0,d(a)),i[e]=c,(g+=1)===f&&(h=!0,b(i)))}for(var f=a.length,g=0,h=!1,i=[],j=0;j<f;j+=1)!function(b){var d=a[b];d instanceof c||(d=new c(d)),d.then(function(a){e(null,a,b)},function(a){e(a||!0)})}(j)})},c.race=function(a){return new c(function(b,d){function e(a,c){g||(null==a?(g=!0,b(c)):(h+=1)>=f&&(g=!0,d(a)))}for(var f=a.length,g=!1,h=0,i=0;i<f;i+=1)!function(b){var d=a[b];d instanceof c||(d=new c(d)),d.then(function(a){e(null,a)},function(a){e(a||!0)})}(i)})},c.step=function(a){var b=a.length,d=new c,e=function(f,g){if(f>=b)return d.l(g);new c(a[f]).then(function(a){e(f+1,a)},function(a){d.j(a)})};return new c(a[0]).then(function(a){e(1,a)},function(a){d.j(a)}),d},c.prototype.t=function(a,b){return this.then(a,b)},c}();_Promise.debug(),PureEvent.prototype={b:function(a,b){var c=this;return c.a[a]?c.a[a].push(b):c.a[a]=[b],c},c:function(a,b){var c=this,d=c.a[a];if(d){for(var e=0,f=d.length;e<f;e+=1)d[e](b);return c}},d:function(){this.a={}}};var uid=function(){return function(){return parseInt(1e4*Math.random())+(new Date).valueOf()}}(),data=function(){var a=[];return{u:function(b,c){a[b]=c},v:function(b){return a[b]}}}(),ERROR="error",GATEWAY_FAIL="gateway_fail",GATEWAY_SUCCESS="gateway_success",SENDMESSAGE_SUCCESS="sendmessage_success",SENDMESSAGE_FAIL="sendmessage_fail",CHECKMESSAGE_SUCCESS="checkmessage_success",CHECKMESSAGE_FAIL="checkmessage_fail",ajax=function(){return{e:function(){return window.XMLHttpRequest&&window.JSON},f:function(a,b,c,d,e){var f=window.JSON.stringify(b);if(b&&"object"==typeof b){var g=[];for(var h in b)g.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));f=g.join("&")}var i=new window.XMLHttpRequest;i.open("POST",a,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Accept","application/json"),i.timeout=e,i.onload=function(){c(window.JSON.parse(i.responseText))},i.ontimeout=function(){d({error:"timeout"})},i.onreadystatechange=function(){4===i.readyState&&(200===i.status?c(window.JSON.parse(i.responseText)):d({error:"status: "+i.status}))},i.send(f)}}}(),TIMEOUT=3e4,TIMEOUT_ERROR="网络不给力",loadJS=function(a,b){return new _Promise(function(c,d){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.onload=f.onreadystatechange=function(){f.readyState&&"loaded"!==f.readyState&&"complete"!==f.readyState?d(TIMEOUT_ERROR):c(f)},f.onerror=function(a){d(TIMEOUT_ERROR),f.parentNode.removeChild(f)},f.src=a,e.appendChild(f),setTimeout(function(){d(TIMEOUT_ERROR),f.parentNode.removeChild(f)},b||TIMEOUT)})},normalizeDomain=function(a){return a.replace(/^https?:\/\/|\/$/g,"")},normalizePath=function(a){return a=a.replace(/\/+/g,"/"),0!==a.indexOf("/")&&(a="/"+a),a},normalizeQuery=function(a){if(!a)return"";var b="?";for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b=b+encodeURIComponent(c)+"="+encodeURIComponent(d)+"&"}return"?"===b&&(b=""),b.replace(/&$/,"")},makeURL=function(a,b,c,d){if(!0===d)return c;a=a||location.protocol+"//",b=normalizeDomain(b);var e=normalizePath(c);return b&&(e=a+b+e),e},jsonp=function(a){var b=makeURL(a.protocol,a.domain,a.path,a.fullurl),c=a.query;return new _Promise(ajax.e()&&!a.get?function(d,e){ajax.f(b,c,function(a){d(a)},function(a){e(a)},a.timeout||TIMEOUT)}:function(d,e){var f=a.cb||"geetest_"+uid();a.cb?f=a.cb:c.callback=f;var g=b+normalizeQuery(c);window[f]=function(b){a&&a.recordurl&&(b=b||{},b.url=g),d(b),window[f]=undefined;try{delete window[f]}catch(c){}},loadJS(g,a.timeout||TIMEOUT).t(function(){},function(a){e(a)})})};Error.pre_gateway_net=function(a){return{code:100}},Error.pre_gateway_result=function(a){return{code:101}},Error.pre_getmobile_net=function(a){return{code:102}},Error.pre_getmobile_result=function(a){return{code:103}},Error.cm_token_error=function(a){return{code:104}},Error.record_token_net=function(a){return{code:105}},Error.record_token_result=function(a){return{code:106}};var YDRZ=function(win,doc){function uuid(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;c<a;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;c<36;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("")}function getFingerPrint(){return encodeURIComponent(base64encode(getBrowserInfo()))}function dateFormat(a,b){var c={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),"S+":a.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in c)new RegExp("("+d+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?c[d]:((3==RegExp.$1.length&&"S+"==d?"000":"00")+c[d]).substr((""+c[d]).length)));return b}function checkParms(a){var b=!0;for(p in a.data)if(""===a.data[p]||a.data[p]===undefined)return a.error({code:"500",message:p+"为空，请检查参数是否正确"}),void(b=!1);return b}function getBrowserInfo(){var a=navigator.userAgent,b=a.indexOf("Android")>-1||a.indexOf("Linux")>-1,c=!0===b?"Android":"IOS";return"location:"+top.location.href+"@@platform:"+top.navigator.platform+"@@userAgent:"+top.navigator.userAgent+"@@appVersion:"+top.navigator.appVersion+"@@cookieEnabled:"+top.navigator.cookieEnabled+"@@cpuClass:"+top.navigator.cpuClass+"@@hardwareConcurrency:"+top.navigator.hardwareConcurrency+"@@language:"+top.navigator.language+"@@plugins:"+top.navigator.plugins+"@@availWidth:"+top.screen.availWidth+"@@availHeight:"+top.navigator.availHeight+"@@colorDepth:"+top.screen.colorDepth+"@@getTimezoneOffset:"+top.Date.getTimezoneOffset+"@@isAndroidOrIOS:"+c}function base64encode(a){var b,c,d,e,f,g,h,i="",j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0;for(a=_utf8_encode(a);k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);return i}function _utf8_encode(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var opts={getMobileUrl:{test01:"http://120.197.235.101:8315/NumberAbility/h5/getMobile.htm?",pro:"http://www.cmpassport.com/NumberAbility/h5/getMobile.htm?"},getToken:{test01:"http://120.197.235.101:8315/NumberAbility/h5/getToken.htm",pro:"https://www.cmpassport.com/NumberAbility/h5/getToken.htm"},optparams:{uuid:"",msgId:"",timestamp:dateFormat(new Date,"yyyyMMddhhmmssSSS"),userInformation:getFingerPrint(),isimge:!1}};YDRZ={getSign:function(a,b){return opts.optparams.uuid=uuid(16,16),opts.optparams.msgId=Math.random(),a+opts.optparams.msgId+opts.optparams.timestamp+opts.optparams.uuid+b},getTokenInfo:function(a){var b=""===a.data.expandParams?"callType=6005":"callType=6005|"+a.data.expandParams,c=""===a.data.expandParams?"callType=6006":"callType=6006|"+a.data.expandParams,d={version:a.data.version,appId:a.data.appId,openType:a.data.openType,expandParams:a.data.expandParams,isTest:a.data.isTest,sign:a.data.sign,uuid:opts.optparams.uuid,msgId:opts.optparams.msgId,timestamp:opts.optparams.timestamp,userInformation:opts.optparams.userInformation},e="0"===d.isTest?opts.getMobileUrl.test01:opts.getMobileUrl.pro,f=e+"version="+d.version+"&appId="+d.appId+"&openType="+d.openType+"&expandParams="+encodeURIComponent(b)+"&msgId="+d.msgId+"&timestamp="+d.timestamp+"&uuid="+d.uuid+"&userInformation="+d.userInformation,g=this;this.isLoaded=!1,this.isTimeout=!1;var h=doc.createElement("img");h.style.display="none",h.src=f,doc.body.appendChild(h),h.onload=function(){if(!g.isTimeout){g.isLoaded=!0,doc.body.removeChild(h);var b={header:{version:d.version,msgId:d.msgId,timestamp:d.timestamp,appId:d.appId},body:{expandParams:encodeURIComponent(c),sign:d.sign,uuid:d.uuid}},e="0"===d.isTest?opts.getToken.test01:opts.getToken.pro;try{request.ajax({request:{url:e,method:"post",data:JSON.stringify(b)},success:function(b){if(""==b.result.body.token){var c={code:b.result.header.resultCode,message:b.result.body.resultDesc};return a.error({code:c.code,message:c.message}),c}var c={code:b.result.header.resultCode,token:b.result.body.token,userInformation:d.userInformation,message:"获取token成功"};a.success({code:c.code,message:c.message,token:c.token,userInformation:c.userInformation})},error:function(b){var c={code:"500",message:"接口异常，获取token失败"};return a.error({code:c.code,message:c.message}),c}})}catch(f){throw new Error(f)}}},h.onerror=function(){g.isTimeout||(a.error({code:"500",message:"系统异常,图片请求失败"}),g.isLoaded=!0,doc.body.removeChild(h))}}};var request={utilCreateXHR:function(a){var b=a&&a.window||window;if(b.XMLHttpRequest)return new b.XMLHttpRequest;for(var c=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","Microsoft.XMLHTTP"],d=0;d<c.length;d++)try{return new b.ActiveXObject(c[d])}catch(e){}},parseJson:function(text){var obj=!1;if(text||(obj={code:"ER_NOBODY",summary:"responseText is empty"}),win.JSON&&JSON.parse)try{obj=JSON.parse(text)}catch(ex){}if(!obj)try{obj=eval("("+text+")")}catch(ex){obj={code:"ER_INVALIDJSON",summary:"responseText is invalid json"}}return obj},ajax:function(a){var b=this,a=a||{},c=a.request||{},d=this.utilCreateXHR(a),e=a.success||new Function,f=a.error||new Function,g=c.timeout,h=null;g>0&&(h=setTimeout(function(){3==d.readyState&&200==d.status||(d.abort(),f({result:{code:"ER_TIMEOUT",summary:"timeout"}}))},g)),d.onreadystatechange=function(a){4==d.readyState&&(clearTimeout(h),0!=d.status?304==d.status||d.status>=200&&d.status<300?e({result:b.parseJson(d.responseText),text:d.responseText,status:d.status}):f({result:{code:"ER_NETWORK",summary:"network has error"},text:d.responseText,status:d.status}):f({result:{code:"ER_STATUS",summary:"status is 0"}}))};var i=c.method&&c.method.toLowerCase();d.open(i||"get",c.url,!0);var j=c.data;if(!c.isFormData&&"object"==typeof j){j=[];for(var k in c.data)j.push(k+"="+encodeURIComponent(c.data[k]));j=j.join("&")}if(c.headers)for(var k in c.headers)console.log(d),d.setRequestHeader(k,c.headers[k]);"post"==i&&j||(j=null),d.send(j)}};return YDRZ}(window,document);return Onepass.prototype={constructor:Onepass,x:function(a){var b=this,c=b.w;this.phone=a.phone;var d="geetest_"+uid(),e=YDRZ.getSign("","1.2");jsonp({protocol:this.protocol,domain:this.gtapi_domain,path:"/web/pre_gateway",query:{app_id:b.app_id,sdk:"1.0.4",phone:b.phone,presign:e,clienttype:1},timeout:this.timeout}).t(function(a){a&&200===a.status?(b.process_id=a.process_id,a.data&&1===a.data.operator?b.H(a.data):b.y(a.data,d)):c.c(GATEWAY_FAIL,Error.pre_gateway_result(a))},function(){c.c(GATEWAY_FAIL,Error.pre_gateway_net())})},y:function(a,b){var c=this;c.imageloaded=!1;var d=new Image;d.onload=d.onerror=function(){!0!==c.imageloaded&&(c.imageloaded=!0,c.I())},d.src=a.url+normalizeQuery(a.option),setTimeout(function(){!0!==c.imageloaded&&(c.imageloaded=!0,c.I())},c.timeout)},I:function(){var a=this,b=a.w;jsonp({protocol:a.protocol,domain:a.gtapi_domain,path:"/web/token_status",query:{process_id:a.process_id},timeout:a.timeout}).t(function(c){c&&200===c.status&&!0===c.data.result?b.c(GATEWAY_SUCCESS,{process_id:a.process_id}):(a.G(c),b.c(GATEWAY_FAIL,Error.pre_getmobile_result(c)))},function(){a.G({msg:"request failed"}),b.c(GATEWAY_FAIL,Error.pre_getmobile_net())})},H:function(a){var b=this,c=b.w,d=a.option.appid,e=a.option.sign;YDRZ.getTokenInfo({data:{version:"1.2",appId:d,sign:e,openType:"1"},success:function(a){b.J(a)},error:function(a){c.c(GATEWAY_FAIL,Error.cm_token_error()),jsonp({protocol:b.protocol,domain:b.gtapi_domain,path:"/web/record_token",query:{process_id:b.process_id,result:500,token:"",userInformation:""},timeout:b.timeout})}})},J:function(a){var b=this,c=b.w;jsonp({protocol:b.protocol,domain:b.gtapi_domain,path:"/web/record_token",query:{process_id:b.process_id,result:a.code,token:a.token,userInformation:a.userInformation},timeout:b.timeout}).t(function(a){a&&200===a.status?c.c(GATEWAY_SUCCESS,{process_id:b.process_id}):c.c(GATEWAY_FAIL,Error.record_token_result())},function(){c.c(GATEWAY_FAIL,Error.record_token_net())})},C:function(){this.process_id=""},b:function(a,b){return this.w.b(a,b),this},G:function(a){}},GOP.version="1.0.4",GOP.prototype={gateway:function(a){return this.F&&data.v(this.D).x(a),this},onGatewaySuccess:function(a){return this.F&&data.v(this.D).b(GATEWAY_SUCCESS,a),this},onGatewayFail:function(a){return this.F&&data.v(this.D).b(GATEWAY_FAIL,a),this}},GOP});