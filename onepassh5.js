!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n=n||self).GOP=t()}(this,function(){"use strict";var uid=function(){return parseInt(1e4*Math.random())+(new Date).valueOf()},guid=function(){return c()+c()+c()+c()+c()+c()+c()+c()};function c(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function PureEvent(){this.n={}}function extend(n,t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];n[e]=i}}PureEvent.prototype={t:function(n,t){var e=this;return e.n[n]?e.n[n].push(t):e.n[n]=[t],e},e:function(n,t){var e=this.n[n];if(e){for(var i=0,o=e.length;i<o;i+=1)e[i](t);return this}},i:function(){this.n={}}};var GATEWAY_FAIL="gateway_fail",GATEWAY_SUCCESS="gateway_success",YDRZ=function(win,doc){var chrsz=8;function hex_md5(n){return binl2hex(core_md5(str2binl(n),n.length*chrsz))}function core_md5(n,t){n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;for(var e=1732584193,i=-271733879,o=-1732584194,r=271733878,u=0;u<n.length;u+=16){var c=e,a=i,s=o,f=r;e=md5_ff(e,i,o,r,n[u+0],7,-680876936),r=md5_ff(r,e,i,o,n[u+1],12,-389564586),o=md5_ff(o,r,e,i,n[u+2],17,606105819),i=md5_ff(i,o,r,e,n[u+3],22,-1044525330),e=md5_ff(e,i,o,r,n[u+4],7,-176418897),r=md5_ff(r,e,i,o,n[u+5],12,1200080426),o=md5_ff(o,r,e,i,n[u+6],17,-1473231341),i=md5_ff(i,o,r,e,n[u+7],22,-45705983),e=md5_ff(e,i,o,r,n[u+8],7,1770035416),r=md5_ff(r,e,i,o,n[u+9],12,-1958414417),o=md5_ff(o,r,e,i,n[u+10],17,-42063),i=md5_ff(i,o,r,e,n[u+11],22,-1990404162),e=md5_ff(e,i,o,r,n[u+12],7,1804603682),r=md5_ff(r,e,i,o,n[u+13],12,-40341101),o=md5_ff(o,r,e,i,n[u+14],17,-1502002290),e=md5_gg(e,i=md5_ff(i,o,r,e,n[u+15],22,1236535329),o,r,n[u+1],5,-165796510),r=md5_gg(r,e,i,o,n[u+6],9,-1069501632),o=md5_gg(o,r,e,i,n[u+11],14,643717713),i=md5_gg(i,o,r,e,n[u+0],20,-373897302),e=md5_gg(e,i,o,r,n[u+5],5,-701558691),r=md5_gg(r,e,i,o,n[u+10],9,38016083),o=md5_gg(o,r,e,i,n[u+15],14,-660478335),i=md5_gg(i,o,r,e,n[u+4],20,-405537848),e=md5_gg(e,i,o,r,n[u+9],5,568446438),r=md5_gg(r,e,i,o,n[u+14],9,-1019803690),o=md5_gg(o,r,e,i,n[u+3],14,-187363961),i=md5_gg(i,o,r,e,n[u+8],20,1163531501),e=md5_gg(e,i,o,r,n[u+13],5,-1444681467),r=md5_gg(r,e,i,o,n[u+2],9,-51403784),o=md5_gg(o,r,e,i,n[u+7],14,1735328473),e=md5_hh(e,i=md5_gg(i,o,r,e,n[u+12],20,-1926607734),o,r,n[u+5],4,-378558),r=md5_hh(r,e,i,o,n[u+8],11,-2022574463),o=md5_hh(o,r,e,i,n[u+11],16,1839030562),i=md5_hh(i,o,r,e,n[u+14],23,-35309556),e=md5_hh(e,i,o,r,n[u+1],4,-1530992060),r=md5_hh(r,e,i,o,n[u+4],11,1272893353),o=md5_hh(o,r,e,i,n[u+7],16,-155497632),i=md5_hh(i,o,r,e,n[u+10],23,-1094730640),e=md5_hh(e,i,o,r,n[u+13],4,681279174),r=md5_hh(r,e,i,o,n[u+0],11,-358537222),o=md5_hh(o,r,e,i,n[u+3],16,-722521979),i=md5_hh(i,o,r,e,n[u+6],23,76029189),e=md5_hh(e,i,o,r,n[u+9],4,-640364487),r=md5_hh(r,e,i,o,n[u+12],11,-421815835),o=md5_hh(o,r,e,i,n[u+15],16,530742520),e=md5_ii(e,i=md5_hh(i,o,r,e,n[u+2],23,-995338651),o,r,n[u+0],6,-198630844),r=md5_ii(r,e,i,o,n[u+7],10,1126891415),o=md5_ii(o,r,e,i,n[u+14],15,-1416354905),i=md5_ii(i,o,r,e,n[u+5],21,-57434055),e=md5_ii(e,i,o,r,n[u+12],6,1700485571),r=md5_ii(r,e,i,o,n[u+3],10,-1894986606),o=md5_ii(o,r,e,i,n[u+10],15,-1051523),i=md5_ii(i,o,r,e,n[u+1],21,-2054922799),e=md5_ii(e,i,o,r,n[u+8],6,1873313359),r=md5_ii(r,e,i,o,n[u+15],10,-30611744),o=md5_ii(o,r,e,i,n[u+6],15,-1560198380),i=md5_ii(i,o,r,e,n[u+13],21,1309151649),e=md5_ii(e,i,o,r,n[u+4],6,-145523070),r=md5_ii(r,e,i,o,n[u+11],10,-1120210379),o=md5_ii(o,r,e,i,n[u+2],15,718787259),i=md5_ii(i,o,r,e,n[u+9],21,-343485551),e=safe_add(e,c),i=safe_add(i,a),o=safe_add(o,s),r=safe_add(r,f)}return Array(e,i,o,r)}function md5_cmn(n,t,e,i,o,r){return safe_add(bit_rol(safe_add(safe_add(t,n),safe_add(i,r)),o),e)}function md5_ff(n,t,e,i,o,r,u){return md5_cmn(t&e|~t&i,n,t,o,r,u)}function md5_gg(n,t,e,i,o,r,u){return md5_cmn(t&i|e&~i,n,t,o,r,u)}function md5_hh(n,t,e,i,o,r,u){return md5_cmn(t^e^i,n,t,o,r,u)}function md5_ii(n,t,e,i,o,r,u){return md5_cmn(e^(t|~i),n,t,o,r,u)}function safe_add(n,t){var e=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(e>>16)<<16|65535&e}function bit_rol(n,t){return n<<t|n>>>32-t}function str2binl(n){for(var t=Array(),e=(1<<chrsz)-1,i=0;i<n.length*chrsz;i+=chrsz)t[i>>5]|=(n.charCodeAt(i/chrsz)&e)<<i%32;return t}function binl2hex(n){for(var t="0123456789abcdef",e="",i=0;i<4*n.length;i++)e+=t.charAt(n[i>>2]>>i%4*8+4&15)+t.charAt(n[i>>2]>>i%4*8&15);return e}var opts={getMobileUrl:{test01:"http://120.197.235.102/NumberAbility/h5/getMobile.htm?",pro:"http://www.cmpassport.com/NumberAbility/h5/getMobile.htm?"},getToken:{test01:"http://120.197.235.102/NumberAbility/h5/getToken.htm",pro:"https://www.cmpassport.com/NumberAbility/h5/getToken.htm"},optparams:{uuid:"",msgId:"",timestamp:dateFormat(new Date,"yyyyMMddhhmmssSSS"),userInformation:getFingerPrint(),isimge:!1}};function uuid(n,t){var e,i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[];if(t=t||o.length,n)for(e=0;e<n;e++)r[e]=o[0|Math.random()*t];else for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",e=0;e<36;e++)r[e]||(i=0|16*Math.random(),r[e]=o[19==e?3&i|8:i]);return r.join("")}function getFingerPrint(){return encodeURIComponent(base64encode(getBrowserInfo()))}function dateFormat(n,t){var e={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),"S+":n.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:((3==RegExp.$1.length&&"S+"==i?"000":"00")+e[i]).substr((""+e[i]).length)));return t}var YDRZ={getSign:function(n,t){return opts.optparams.uuid=uuid(32,32),opts.optparams.msgId=uuid(32,32),n+opts.optparams.msgId+opts.optparams.timestamp+opts.optparams.uuid+t},getTokenInfo:function(i){var n=""===i.data.expandParams?"callType=6005":"callType=6005|"+i.data.expandParams,o=""===i.data.expandParams?"callType=6006":"callType=6006|"+i.data.expandParams,r={version:i.data.version,appId:i.data.appId,openType:i.data.openType,expandParams:i.data.expandParams,isTest:i.data.isTest,sign:i.data.sign,uuid:opts.optparams.uuid,msgId:opts.optparams.msgId,timestamp:opts.optparams.timestamp,userInformation:opts.optparams.userInformation},t=("0"===r.isTest?opts.getMobileUrl.test01:opts.getMobileUrl.pro)+"version="+r.version+"&appId="+r.appId+"&openType="+r.openType+"&expandParams="+encodeURIComponent(n)+"&msgId="+r.msgId+"&timestamp="+r.timestamp+"&uuid="+r.uuid+"&userInformation="+r.userInformation,u=this;this.isLoaded=!1,this.isTimeout=!1;var c=doc.createElement("img");c.style.display="none",c.src=t,doc.body.appendChild(c);var a=null;0<i.data.timeout&&(a=setTimeout(function(){u.isTimeout=!0,i.error({code:"500",message:"超时",msgId:r.msgId})},i.data.timeout)),c.onload=function(){if(clearTimeout(a),!u.isTimeout){u.isLoaded=!0,doc.body.removeChild(c);var n={header:{version:r.version,msgId:r.msgId,timestamp:r.timestamp,appId:r.appId},body:{expandParams:o,sign:r.sign,uuid:r.uuid}},t="0"===r.isTest?opts.getToken.test01:opts.getToken.pro;try{request.ajax({request:{url:t,method:"post",data:JSON.stringify(n),timeout:i.data.timeout},success:function(n){if(""==n.result.body.token){t={code:n.result.header.resultCode,message:n.result.body.resultDesc};return i.error({code:t.code,message:t.message,msgId:r.msgId}),t}var t={code:n.result.header.resultCode,token:n.result.body.token,userInformation:r.userInformation,message:"获取token成功"};i.success({code:t.code,message:t.message,token:t.token,userInformation:t.userInformation})},error:function(n){var t={code:"500",message:"接口异常，获取token失败"};return i.error({code:t.code,message:t.message,msgId:r.msgId}),t}})}catch(e){throw new Error(e)}}},c.onerror=function(){u.isTimeout||(clearTimeout(a),i.error({code:"500",message:"取号失败",msgId:r.msgId}),u.isLoaded=!0,doc.body.removeChild(c))}}};function getBrowserInfo(){var n=navigator.userAgent,t=(-1<n.indexOf("Android")||n.indexOf("Linux"),window.navigator.platform+"@@"+window.navigator.userAgent+"@@"+window.navigator.appVersion+"@@"+window.navigator.cookieEnabled+"@@"+window.navigator.cpuClass+"@@"+window.navigator.hardwareConcurrency+"@@"+window.navigator.language+"@@"+window.navigator.plugins+"@@"+window.screen.availWidth+"@@"+window.navigator.availHeight+"@@"+window.screen.colorDepth+"@@"+window.Date.getTimezoneOffset);return window.navigator.platform+"@@"+window.navigator.userAgent+"@@"+hex_md5(t)}function base64encode(n){var t,e,i,o,r,u,c,a="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=0;for(n=_utf8_encode(n);f<n.length;)o=(t=n.charCodeAt(f++))>>2,r=(3&t)<<4|(e=n.charCodeAt(f++))>>4,u=(15&e)<<2|(i=n.charCodeAt(f++))>>6,c=63&i,isNaN(e)?u=c=64:isNaN(i)&&(c=64),a=a+s.charAt(o)+s.charAt(r)+s.charAt(u)+s.charAt(c);return a}function _utf8_encode(n){n=n.replace(/\r\n/g,"\n");for(var t="",e=0;e<n.length;e++){var i=n.charCodeAt(e);i<128?t+=String.fromCharCode(i):(127<i&&i<2048?t+=String.fromCharCode(i>>6|192):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128)),t+=String.fromCharCode(63&i|128))}return t}var request={utilCreateXHR:function(n){var t=n&&n.window||window;if(t.XMLHttpRequest)return new t.XMLHttpRequest;for(var e=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","Microsoft.XMLHTTP"],i=0;i<e.length;i++)try{return new t.ActiveXObject(e[i])}catch(o){}},parseJson:function(text){var obj=!1;if(text||(obj={code:"ER_NOBODY",summary:"responseText is empty"}),win.JSON&&JSON.parse)try{obj=JSON.parse(text)}catch(ex){}if(!obj)try{obj=eval("("+text+")")}catch(ex){obj={code:"ER_INVALIDJSON",summary:"responseText is invalid json"}}return obj},ajax:function(n){var t=this,e=(n=n||{}).request||{},i=this.utilCreateXHR(n),o=n.success||new Function,r=n.error||new Function,u=e.timeout,c=null;0<u&&(c=setTimeout(function(){3==i.readyState&&200==i.status||(i.abort(),r({result:{code:"ER_TIMEOUT",summary:"timeout"}}))},u)),i.onreadystatechange=function(n){4==i.readyState&&(clearTimeout(c),0!=i.status?304==i.status||200<=i.status&&i.status<300?o({result:t.parseJson(i.responseText),text:i.responseText,status:i.status}):r({result:{code:"ER_NETWORK",summary:"network has error"},text:i.responseText,status:i.status}):r({result:{code:"ER_STATUS",summary:"status is 0"}}))};var a=e.method&&e.method.toLowerCase();i.open(a||"get",e.url,!0);var s=e.data;if(!e.isFormData&&"object"==typeof s){for(var f in s=[],e.data)s.push(f+"="+encodeURIComponent(e.data[f]));s=s.join("&")}if(e.headers)for(var f in e.headers)i.setRequestHeader(f,e.headers[f]);"post"==a&&s||(s=null),i.send(s)}};return YDRZ}(window,document),_Promise=(Jb=function(n){return"function"==typeof n},Lb=function(n){n()},Nb=function(t,n){if(t===n)t.o(new TypeError);else if(n instanceof Ob)n.then(function(n){Nb(t,n)},function(n){t.o(n)});else if(Jb(n)||"object"==typeof(o=n)&&null!==o){var e;try{e=n.then}catch(r){return Ob.r(r),void t.o(r)}var i=!1;if(Jb(e))try{e.call(n,function(n){i||(i=!0,Nb(t,n))},function(n){i||(i=!0,t.o(n))})}catch(r){if(i)return;i=!0,t.o(r)}else t.u(n)}else t.u(n);var o},Pb=!(Mb.prototype={enqueue:function(n){var t=this,e={ele:n,next:null};null===t.c?t.c=this.a=e:(t.a.next=e,t.a=t.a.next)},dequeue:function(){if(null===this.c)throw new Error("queue is empty");var n=this.c.ele;return this.c=this.c.next,n},isEmpty:function(){return null===this.c},clear:function(){this.c=this.s=null},each:function(n){this.isEmpty()||(n(this.dequeue()),this.each(n))}}),Ob.debug=function(){Pb=!0},Ob.r=function(n){Pb&&"undefined"!=typeof console&&console.error(n)},Ob.prototype={PENDING:0,RESOLVED:1,REJECTED:-1,u:function(n){var t=this;t.f===t.PENDING&&(t.f=t.RESOLVED,t.d=n,t.m())},o:function(n){var t=this;t.f===t.PENDING&&(t.f=t.REJECTED,t.h=n,t.m())},m:function(){var n,t,e=this,i=e.f;i===e.RESOLVED?(n=e.p,e._.clear(),t=e.d):i===e.REJECTED&&(n=e._,e.p.clear(),t=e.h),n.each(function(n){Lb(function(){n(i,t)})})},l:function(e,i,o){var r=this;Lb(function(){if(Jb(i)){var n;try{n=i(o)}catch(t){return Ob.r(t),void r.o(t)}Nb(r,n)}else e===r.RESOLVED?r.u(o):e===r.REJECTED&&r.o(o)})},then:function(e,i){var n=this,o=new Ob;return n.p.enqueue(function(n,t){o.l(n,e,t)}),n._.enqueue(function(n,t){o.l(n,i,t)}),n.f===n.RESOLVED?n.m():n.f===n.REJECTED&&n.m(),o}},Ob.all=function(s){return new Ob(function(i,o){var r=s.length,u=0,c=!1,a=[];function e(n,t,e){c||(null!==n&&(c=!0,o(n)),a[e]=t,(u+=1)===r&&(c=!0,i(a)))}for(var n=0;n<r;n+=1)!function(t){var n=s[t];n instanceof Ob||(n=new Ob(n)),n.then(function(n){e(null,n,t)},function(n){e(n||!0)})}(n)})},Ob.race=function(a){return new Ob(function(e,i){var n,o=a.length,r=!1,u=0;function t(n,t){r||(null==n?(r=!0,e(t)):o<=(u+=1)&&(r=!0,i(n)))}for(var c=0;c<o;c+=1)n=void 0,(n=a[c])instanceof Ob||(n=new Ob(n)),n.then(function(n){t(null,n)},function(n){t(n||!0)})})},Ob.step=function(e){var i=e.length,o=new Ob,r=function(t,n){if(i<=t)return o.u(n);new Ob(e[t]).then(function(n){r(t+1,n)},function(n){o.o(n)})};return new Ob(e[0]).then(function(n){r(1,n)},function(n){o.o(n)}),o},Ob.prototype.g=function(n,t){return this.then(n,t)},Ob),Jb,Lb,Nb,Pb;function Mb(){this.c=this.a=null}function Ob(n){var t=this;if(t.f=t.PENDING,t.p=new Mb,t._=new Mb,Jb(n))try{n(function(n){t.u(n)},function(n){t.o(n)})}catch(e){Ob.r(e)}}_Promise.debug();var ajax={w:function(){return window.XMLHttpRequest&&window.JSON},v:function(n,t,e,i,o){var r=window.JSON.stringify(t);if(t&&"object"==typeof t){var u=[];for(var c in t)u.push(encodeURIComponent(c)+"="+encodeURIComponent(t[c]));r=u.join("&")}var a=new window.XMLHttpRequest;a.open("POST",n,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("Accept","application/json"),a.timeout=o,a.onload=function(){e(window.JSON.parse(a.responseText))},a.ontimeout=function(){i({error:"timeout"})},a.onreadystatechange=function(){4===a.readyState&&(200===a.status?e(window.JSON.parse(a.responseText)):i({error:"status: "+a.status}))},a.send(r)}},TIMEOUT=3e4,TIMEOUT_ERROR="网络不给力",loadJS=function(o,r){return new _Promise(function(n,t){var e=document.getElementsByTagName("head")[0],i=document.createElement("script");i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!==i.readyState&&"complete"!==i.readyState?t(TIMEOUT_ERROR):n(i)},i.onerror=function(){t(TIMEOUT_ERROR),i.parentNode.removeChild(i)},i.src=o,e.appendChild(i),setTimeout(function(){t(TIMEOUT_ERROR),i.parentNode.removeChild(i)},r||TIMEOUT)})},normalizeDomain=function(n){return n.replace(/^https?:\/\/|\/$/g,"")},normalizePath=function(n){return 0!==(n=n.replace(/\/+/g,"/")).indexOf("/")&&(n="/"+n),n},normalizeQuery=function(n){if(!n)return"";var t="?";for(var e in n)if(n.hasOwnProperty(e)){var i=n[e];t=t+encodeURIComponent(e)+"="+encodeURIComponent(i)+"&"}return"?"===t&&(t=""),t.replace(/&$/,"")},makeURL=function(n,t,e,i){if(!0===i)return e;n=n||location.protocol+"//",t=normalizeDomain(t);var o=normalizePath(e);return t&&(o=n+t+o),o},jsonp=function(r){var n=makeURL(r.protocol,r.domain,r.path,r.fullurl),u=r.query;return ajax.w()&&!r.get?new _Promise(function(t,e){ajax.v(n,u,function(n){t(n)},function(n){e(n)},r.timeout||TIMEOUT)}):new _Promise(function(e,t){var i=r.cb||"geetest_"+uid();r.cb?i=r.cb:u.callback=i;var o=n+normalizeQuery(u);window[i]=function(n){r&&r.recordurl&&((n=n||{}).url=o),e(n),window[i]=undefined;try{delete window[i]}catch(t){}},loadJS(o,r.timeout||TIMEOUT).g(function(){},function(n){t(n)})})},CUAU=(ue={precheckUrl:{test:"https://opencloud.wostore.cn/openapi-test/netauth/precheck/u3",pro:"https://opencloud.wostore.cn/openapi/netauth/precheck/u3"},optparams:{uuid:"",timestamp:Date.now(),version:"v4.0",clientType:"2",format:"jsonp",clientId:"",timeout:5e3,result:""}},{getSign:function(n){return"cuCallback"+n+ue.optparams.clientType+ue.optparams.format+ue.optparams.timestamp+ue.optparams.version},getAuthCode:function(n){if("[object Function]"!==Object.prototype.toString.call(n.result))throw{error:"arguments invalid"};ue.optparams.clientId=n.clientId,ue.optparams.timeout=n.timeout,ue.optparams.result=n.result,ue.optparams.uuid=function u(n,t){var e,i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[];if(t=t||o.length,n)for(e=0;e<n;e++)r[e]=o[0|Math.random()*t];else for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",e=0;e<36;e++)r[e]||(i=0|16*Math.random(),r[e]=o[19==e?3&i|8:i]);return r.join("")}(32,32),function r(n){var t=ue.optparams.timeout,e="cuCallback",i={callback:e,timestamp:ue.optparams.timestamp,client_id:ue.optparams.clientId,client_type:ue.optparams.clientType,version:ue.optparams.version,format:ue.optparams.format,sign:n},o={code:"408",msg:"请求超时"};jsonp({get:!0,path:ue.precheckUrl.pro,query:i,fullurl:!0,cb:e,timeout:t}).g(function(n){var t={code:n.code,msg:n.msg};0==n.code?(t.accesscode=n.data.accessCode,t.operatorType=n.data.operatorType):t.msgId=n.data,ue.optparams.result(t)},function(n){("网络不给力"==n||n.status&&"timeout"==n.status)&&!function t(n){ue.optparams.result({code:n.code,msg:n.msg})}(o)})}(n.sign)}}),ue;function Error$1(){}Error$1.pre_gateway_net=function(){return{code:100}},Error$1.pre_gateway_result=function(){return{code:101}},Error$1.pre_getmobile_net=function(){return{code:102}},Error$1.pre_getmobile_result=function(){return{code:103}},Error$1.cm_token_error=function(){return{code:104}},Error$1.record_token_net=function(){return{code:105}},Error$1.record_token_result=function(){return{code:106}},Error$1.cu_token_error=function(){return{code:107}},Error$1.change_gateway=function(n){return{code:n&&n.code||108}};var user_agent=navigator.userAgent.toLowerCase(),connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{type:"unknown"},common_cell=["cellular","2g","3g","4g"],checkNetInfo=function(){if(-1!==user_agent.indexOf("nettype/wifi"))return"wifi";var n=connection&&connection.type;return n&&-1!==common_cell.indexOf(n)?"cellular":"wifi"===n?"wifi":"unknown"},canClick=!0;function Onepass(n){this.gtapi_domain="onepass.geetest.com",this.protocol=location.protocol+"//",extend(this,n),this.phone=0,this.process_id="",this.b=new PureEvent,this.presign=YDRZ.getSign("","1.2"),this.presign_cu=CUAU.getSign("{client_id}"),this.OnepassConfig={haspreASK:!1,presign:this.presign,presign_cu:this.presign_cu,data:{},cb:"geetest_"+uid(),ip:!1},this.pre_init=n.pre_init===undefined||n.pre_init,this.pre_init&&this.y()}Onepass.prototype={constructor:Onepass,T:function(n){var e=this;if(e.phone=n&&n.phone||"",canClick){canClick=!1;var t=e.OnepassConfig.haspreASK&&e.OnepassConfig.data.data&&!e.OnepassConfig.ip&&!e.phone;if(e.OnepassConfig.haspreASK&&e.OnepassConfig.data.data&&e.OnepassConfig.ip||t)e.O(e.OnepassConfig.data,e.OnepassConfig.cb);else{var i=e.b,o="geetest_"+uid(),r=YDRZ.getSign("","1.2"),u=CUAU.getSign("{client_id}");jsonp({protocol:this.protocol,domain:this.gtapi_domain,path:"/web/pre_gateway",query:{app_id:e.app_id,sdk:"2.1.1",phone:e.phone,presign:r,presign_cu:u,clienttype:1,callback:o},timeout:this.timeout}).g(function(n){if(n&&200===n.status)e.O(n,o);else{canClick=!0;var t=guid();i.e(GATEWAY_FAIL,Error$1.pre_gateway_result()),e.I({process_id:t,msg:"请求pregateway出错",phone:e.phone},"101")}},function(){canClick=!0,i.e(GATEWAY_FAIL,Error$1.pre_gateway_net());var n=guid();e.I({process_id:n,msg:"请求pregateway失败",phone:e.phone},"100")})}}},A:function(n,t,e){var i=this,o=i.b;jsonp({get:!0,path:n.url,query:n.option[t],fullurl:!0,cb:e,timeout:i.timeout}).g(function(n){canClick=!0,!n||1e4!==n.result&&0!==n.result?(o.e(GATEWAY_FAIL,Error$1.pre_getmobile_result()),i.I(n,"103")):(o.e(GATEWAY_SUCCESS,{process_id:i.process_id,phone:i.phone,accesscode:n.data}),i.I(n,"0"))},function(){canClick=!0,o.e(GATEWAY_FAIL,Error$1.pre_getmobile_net()),i.I({code:400,msg:"接口请求失败 ||超时"},"400")})},S:function(n,t){var e=this,i=e.b,o=n.option[t].appid,r=n.option[t].sign;YDRZ.getTokenInfo({data:{version:"1.2",appId:o,sign:r,openType:"1",timeout:e.timeout||3e3},success:function(n){canClick=!0,i.e(GATEWAY_SUCCESS,{process_id:e.process_id,phone:e.phone,accesscode:n.token+"||"+n.userInformation}),e.I(n,"0")},error:function(n){canClick=!0,i.e(GATEWAY_FAIL,Error$1.cm_token_error()),e.I(n,"104")}})},M:function(n,t){var e=this,i=e.b;CUAU.getAuthCode({clientId:n.option[t].client_id,sign:n.option[t].sign,timeout:e.timeout||3e3,result:function(n){"0"==n.code?n.operatorType&&"CU"===n.operatorType&&(canClick=!0,i.e(GATEWAY_SUCCESS,{process_id:e.process_id,phone:e.phone,accesscode:n.accesscode}),e.I(n,"0")):(canClick=!0,i.e(GATEWAY_FAIL,Error$1.cu_token_error()),e.I(n,"108"))}})},R:function(){this.process_id=""},t:function(n,t){return this.b.t(n,t),this},I:function(n,t){var e=t||"undefined";n&&"object"==typeof n&&(n=JSON.stringify(n));var i=this.process_id||n&&n.process_id,o=checkNetInfo();jsonp({protocol:this.protocol,domain:this.gtapi_domain,query:{process_id:i,code:e,metadata:n,k:o},path:"/web/client_report",timeout:this.timeout})},y:function(){var e=this;jsonp({protocol:this.protocol,domain:this.gtapi_domain,path:"/web/pre_gateway",query:{app_id:e.app_id,sdk:"2.1.1",presign:e.OnepassConfig.presign,presign_cu:e.OnepassConfig.presign_cu,clienttype:1,callback:e.OnepassConfig.cb,type:"pre"},timeout:this.timeout}).g(function(n){if(e.OnepassConfig.haspreASK=!0,n&&200===n.status)e.OnepassConfig.data=n,e.OnepassConfig.ip=n.data&&1===n.data.operator_rule||!1;else{var t=guid();e.OnepassConfig.haspreASK=!0,e.OnepassConfig.ip=!1,e.I({process_id:t,msg:"请求pregateway出错"},"101")}},function(){var n=guid();e.OnepassConfig.haspreASK=!1,e.OnepassConfig.ip=!1,e.I({process_id:n,msg:"请求pregateway失败"},"100")})},O:function(n,t){var e=this;e.process_id=n.process_id,e.OnepassConfig.haspreASK=!1,n.data&&1===n.data.operator?e.S(n.data,n.data.operator):n.data&&3===n.data.operator?e.M(n.data,n.data.operator):e.A(n.data,n.data.operator,t)}};var data=(Mf=[],{C:function(n,t){Mf[n]=t},U:function(n){return Mf[n]}}),Mf;function GOP(n){this.x=uid(),this.j=!0,data.C(this.x,new Onepass(n))}return GOP.version="2.1.1",GOP.prototype={gateway:function(n){return this.j&&data.U(this.x).T(n),this},onGatewaySuccess:function(n){return this.j&&data.U(this.x).t(GATEWAY_SUCCESS,n),this},onGatewayFail:function(n){return this.j&&data.U(this.x).t(GATEWAY_FAIL,n),this},checkNetInfo:function(){return checkNetInfo()}},GOP});
