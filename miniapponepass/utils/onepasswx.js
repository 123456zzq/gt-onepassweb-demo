!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=function(e,t){function n(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,o=-271733879,u=-1732584194,p=271733878,d=0;d<e.length;d+=16){var f=n,m=o,g=u,l=p;n=r(n,o,u,p,e[d+0],7,-680876936),p=r(p,n,o,u,e[d+1],12,-389564586),u=r(u,p,n,o,e[d+2],17,606105819),o=r(o,u,p,n,e[d+3],22,-1044525330),n=r(n,o,u,p,e[d+4],7,-176418897),p=r(p,n,o,u,e[d+5],12,1200080426),u=r(u,p,n,o,e[d+6],17,-1473231341),o=r(o,u,p,n,e[d+7],22,-45705983),n=r(n,o,u,p,e[d+8],7,1770035416),p=r(p,n,o,u,e[d+9],12,-1958414417),u=r(u,p,n,o,e[d+10],17,-42063),o=r(o,u,p,n,e[d+11],22,-1990404162),n=r(n,o,u,p,e[d+12],7,1804603682),p=r(p,n,o,u,e[d+13],12,-40341101),u=r(u,p,n,o,e[d+14],17,-1502002290),o=r(o,u,p,n,e[d+15],22,1236535329),n=i(n,o,u,p,e[d+1],5,-165796510),p=i(p,n,o,u,e[d+6],9,-1069501632),u=i(u,p,n,o,e[d+11],14,643717713),o=i(o,u,p,n,e[d+0],20,-373897302),n=i(n,o,u,p,e[d+5],5,-701558691),p=i(p,n,o,u,e[d+10],9,38016083),u=i(u,p,n,o,e[d+15],14,-660478335),o=i(o,u,p,n,e[d+4],20,-405537848),n=i(n,o,u,p,e[d+9],5,568446438),p=i(p,n,o,u,e[d+14],9,-1019803690),u=i(u,p,n,o,e[d+3],14,-187363961),o=i(o,u,p,n,e[d+8],20,1163531501),n=i(n,o,u,p,e[d+13],5,-1444681467),p=i(p,n,o,u,e[d+2],9,-51403784),u=i(u,p,n,o,e[d+7],14,1735328473),o=i(o,u,p,n,e[d+12],20,-1926607734),n=a(n,o,u,p,e[d+5],4,-378558),p=a(p,n,o,u,e[d+8],11,-2022574463),u=a(u,p,n,o,e[d+11],16,1839030562),o=a(o,u,p,n,e[d+14],23,-35309556),n=a(n,o,u,p,e[d+1],4,-1530992060),p=a(p,n,o,u,e[d+4],11,1272893353),u=a(u,p,n,o,e[d+7],16,-155497632),o=a(o,u,p,n,e[d+10],23,-1094730640),n=a(n,o,u,p,e[d+13],4,681279174),p=a(p,n,o,u,e[d+0],11,-358537222),u=a(u,p,n,o,e[d+3],16,-722521979),o=a(o,u,p,n,e[d+6],23,76029189),n=a(n,o,u,p,e[d+9],4,-640364487),p=a(p,n,o,u,e[d+12],11,-421815835),u=a(u,p,n,o,e[d+15],16,530742520),o=a(o,u,p,n,e[d+2],23,-995338651),n=s(n,o,u,p,e[d+0],6,-198630844),p=s(p,n,o,u,e[d+7],10,1126891415),u=s(u,p,n,o,e[d+14],15,-1416354905),o=s(o,u,p,n,e[d+5],21,-57434055),n=s(n,o,u,p,e[d+12],6,1700485571),p=s(p,n,o,u,e[d+3],10,-1894986606),u=s(u,p,n,o,e[d+10],15,-1051523),o=s(o,u,p,n,e[d+1],21,-2054922799),n=s(n,o,u,p,e[d+8],6,1873313359),p=s(p,n,o,u,e[d+15],10,-30611744),u=s(u,p,n,o,e[d+6],15,-1560198380),o=s(o,u,p,n,e[d+13],21,1309151649),n=s(n,o,u,p,e[d+4],6,-145523070),p=s(p,n,o,u,e[d+11],10,-1120210379),u=s(u,p,n,o,e[d+2],15,718787259),o=s(o,u,p,n,e[d+9],21,-343485551),n=c(n,f),o=c(o,m),u=c(u,g),p=c(p,l)}return Array(n,o,u,p)}(function(e){for(var t=Array(),n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}(e),8*e.length))}function o(e,t,n,o,r,i){return c((a=c(c(t,e),c(o,i)))<<(s=r)|a>>>32-s,n);var a,s}function r(e,t,n,r,i,a,s){return o(t&n|~t&r,e,t,i,a,s)}function i(e,t,n,r,i,a,s){return o(t&r|n&~r,e,t,i,a,s)}function a(e,t,n,r,i,a,s){return o(t^n^r,e,t,i,a,s)}function s(e,t,n,r,i,a,s){return o(n^(t|~r),e,t,i,a,s)}function c(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function u(e,t){var n,o,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||r.length,e)for(n=0;n<e;n++)i[n]=r[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",n=0;n<36;n++)i[n]||(o=0|16*Math.random(),i[n]=r[19==n?3&o|8:o]);return i.join("")}let p={uuid:u(32,32),msgId:u(32,32),timestamp:function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),"S+":e.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[o]:((3==RegExp.$1.length&&"S+"==o?"000":"00")+n[o]).substr((""+n[o]).length)));return t}(new Date,"yyyyMMddhhmmssSSS"),version:"1.2",userInformation:encodeURIComponent(function(e){var t,n,o,r,i,a,s,c="",u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p=0;for(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}(e);p<e.length;)t=e.charCodeAt(p++),n=e.charCodeAt(p++),o=e.charCodeAt(p++),r=t>>2,i=(3&t)<<4|n>>4,a=(15&n)<<2|o>>6,s=63&o,isNaN(n)?a=s=64:isNaN(o)&&(s=64),c=c+u.charAt(r)+u.charAt(i)+u.charAt(a)+u.charAt(s);return c}(function(){try{const t=wx.getSystemInfoSync();var e=t.brand+"@@"+t.model+"@@"+t.pixelRatio+"@@"+t.screenWidth+"@@"+t.screenHeight+"@@"+t.language+"@@"+t.version+"@@"+t.system+"@@"+t.platform+"@@"+t.SDKVersion+"@@"+t.benchmarkLevel+"@@"+(new Date).getTimezoneOffset();return encodeURIComponent(t.brand+"@@"+t.version+"@@"+t.system+"@@"+n(e))}catch(t){}}()))},d="http://120.197.235.102:7002/NumberAbility/h5/getMobile.htm?",f="http://www.cmpassport.com/NumberAbility/h5/getMobile.htm?",m="http://120.197.235.102:7002/NumberAbility/h5/getToken.htm",g="https://www.cmpassport.com/NumberAbility/h5/getToken.htm";return{getSign:function(e){return e+p.msgId+p.timestamp+p.uuid+p.version},getImgSrc:function(e){const t=wx.getAccountInfoSync();let n=""===e.expandParams?"callType=6005":"callType=6005|"+e.expandParams;return("0"===e.isTest?d:f)+"version="+p.version+"&appId="+e.appId+"&openType="+e.openType+"&expandParams="+encodeURIComponent(n)+"&msgId="+p.msgId+"&timestamp="+p.timestamp+"&uuid="+p.uuid+"&userInformation="+p.userInformation+"&wxappid="+t.miniProgram.appId},getTokenInfo:function(e){const t=wx.getAccountInfoSync();var n=""===e.data.expandParams?"callType=6006":"callType=6006|"+e.data.expandParams;let o={version:p.version,appId:e.data.appId,openType:e.data.openType,expandParams:n,isTest:e.data.isTest,sign:e.data.sign,uuid:p.uuid,msgId:p.msgId,timestamp:p.timestamp,userInformation:p.userInformation,wxappid:t.miniProgram.appId,timeout:e.data.timeout||3e3},r={header:{version:o.version,msgId:o.msgId,timestamp:o.timestamp,appId:o.appId},body:{expandParams:o.expandParams,sign:o.sign,uuid:o.uuid,wxappid:o.wxappid}},i="0"===o.isTest?m:g;wx.request({url:i,data:JSON.stringify(r),method:"post",header:{"content-type":"application/json"},timeout:o.timeout||3e3,success(t){if(""!=t.data.body.token){var n={code:t.data.header.resultCode,token:t.data.body.token,userInformation:o.userInformation,message:"获取token成功"};e.success({code:n.code,message:n.message,token:n.token,userInformation:n.userInformation,msgId:o.msgId})}else{n={code:t.data.header.resultCode,message:t.data.body.resultDesc};e.error({code:n.code,message:n.message,msgId:o.msgId})}},fail(t){var n="500",r="接口异常，获取token失败";e.error({code:n,message:r,msgId:o.msgId})}})}}}();function t(e){this.gtapi_domain="onepass.geetest.com",Object.assign(this,e),this.phone=0,this.process_id="",this.version="wx.2.0.0",this.accesscode="",this.cm_data=""}t.prototype={constructor:t,gateway:function(t,n){var o=this,r="geetest_"+(new Date).getTime();this.phone=t;var i=e.getSign("");wx.request({url:"https://onepass.geetest.com/web/pre_gateway",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},timeout:o.timeout||3e3,data:{app_id:this.app_id,sdk:this.version,phone:this.phone,clienttype:2,callback:r,presign:i},success:function(t){var r=t.data;if(r&&200===r.status){o.process_id=r.process_id;var i=[],a=r.data.operator;if(1===a){var s={appId:r.data.option[a].appid,openType:"1"};o.cm_data=r.data.option[a];var c=e.getImgSrc(s);n&&n(null,c)}else{var u=r.data.option[2];for(var p in u)i.push(encodeURIComponent(p)+"="+encodeURIComponent(u[p]));o.getTokenMobile(r.data.url,u,n)}}else n&&n({code:101})},fail:function(){n&&n({code:100})}})},getTokenMobile:function(e,t,n){var o=this;wx.request({url:e,data:t,dataType:"json",timeout:o.timeout||3e3,header:{"content-type":"text/plain;charset=utf-8",accept:"application/json"},success:function(e){200!==e.statusCode||1e4!==e.data.result&&0!==e.data.result?n&&n({code:103}):(o.accesscode=e.data.data,n&&n(null,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="))},fail:function(){n&&n({code:102})}})},getTokenStatus:function(t){var n=this;n.cm_data&&n.cm_data.sign?e.getTokenInfo({data:{appId:n.cm_data.appid,sign:n.cm_data.sign,openType:"1",timeout:n.timeout||3e3},success:function(e){t&&t(null,{process_id:n.process_id,accesscode:e.token+"||"+e.userInformation})},error:function(e){t&&t({code:104})}}):n.accesscode?t&&t(null,{process_id:n.process_id,accesscode:n.accesscode}):t&&t({code:105})}},module.exports=t}));
